{% extends "base_timetable.html" %}
{% load static %}

{% block title %}Day Timetable {{ day }}.{{ month }}.{{ year }}{% endblock %}

{% block content %}
<body>
    <div class="grid-container">
        <div class="header">
            <h1>Timetable {{ day }}.{{ month }}.{{ year }}</h1>
        </div>
        <div class="calendar-settings">
            <form id="activityTypeForm" method="GET" hx-get="{% url 'timetable:update_timetable' timetable_id year month day %}" hx-indicator="#loading-indicator" hx-target="#grid-day">
                {% csrf_token %}
                {% for activity_type in activity_types %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="activity_types" value="{{ activity_type.id }}" id="activity_type{{ activity_type.id }}" onchange="document.getElementById('activityTypeForm').submit()" {% if activity_type.id in selected_activity_types %}checked{% endif %}>
                        <label class="form-check-label" for="activity_type{{ activity_type.id }}">
                            {{ activity_type.type_name }}
                        </label>
                    </div>
                {% endfor %}
            </form>
        </div>
        <div class="calendar-navigation">
                <form action="{% url 'timetable:display_day' timetable_id year month day %}" method="post">
                    {% csrf_token %}
                    <div class="btn-group">
                        <button type="submit" class="btn btn-info" formaction="{% url 'timetable:details' timetable_id %}">Return</button>
                        <button type="submit" class="btn btn-info" formaction="{% url 'timetable:display_month' timetable_id year month %} ">Month</button>
                        <button type="submit" class="btn btn-info" formaction="{% url 'timetable:display_week_for_day' timetable_id year %}" name="day_and_month" value={{day}}_{{month}}>Week</button>
                    </div>
                    <br>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary" name="change_value" value="-7"><<</button>
                        <button type="submit" class="btn btn-primary" name="change_value" value="-1"><</button>
                        <button type="submit" class="btn btn-primary" name="change_value" value="1">></button>
                        <button type="submit" class="btn btn-primary" name="change_value" value="7">>></button>
                    </div>

                    <div>
                        <br>
                        <button class="btn btn-primary" hx-get="{% url 'timetable:add_activity' timetable_id %}" hx-target="#dialog">
                          New activity
                        </button>
                    </div>
                </form>
        </div>
        <div class="grid-day" id="grid-day">

                {% for time in timetable_times %}
                <div class="time-column" style="grid-row: {{time|date:'Hi'}}" >{{ time|date:'H:i'}}</div>
                {% endfor %}
                {% for track in activities %}
                {% for activity in track %}
                <div class="activity" hx-get="{% url 'timetable:activity_details' timetable_id activity.id %}" hx-target="#dialog" style="grid-row: {{activity.time_start|date:'Hi'}} / {{activity.time_end|date:'Hi'}}; grid-column: track{{ forloop.parentloop.counter }} / track{{ track_span }}; margin-top: 50 px; background-color: {{ activity.activity_type.type_color }}">
                    <button onclick="event.stopPropagation();" class="btn btn-link" hx-get="{% url 'timetable:course_details' timetable_id activity.course %}" hx-target="#dialog"><strong style="font-size:xxx-large;">{{ activity.course }}</strong></button> <br>
                    <button onclick="event.stopPropagation();" class="btn btn-link" hx-get="{% url 'timetable:activity_type_details' activity.activity_type %}" hx-target="#dialog"><strong style="font-size:xx-large;">{{ activity.activity_type }}</strong></button> <br>
                    {% for teacher in activity.teacher.all %}
                    <button onclick="event.stopPropagation();" class="btn btn-link" hx-get="{% url 'timetable:teacher_details' teacher %}" hx-target="#dialog"><strong style="font-size:x-large;">{{ teacher }}</strong></button>
                    {% endfor %} <br>
                    {{ activity.time_start|date:'H:i' }} - {{ activity.time_end|date:'H:i' }} <br>
                    <p>{{ activity.description }}</p>
                </div>
                {% endfor %}
                {% endfor %}
        </div>
    </div>
    <div id="modal" class="modal fade">
      <div id="dialog" class="modal-dialog" hx-target="this"></div>
    </div>
<script src="{% static 'timetable/scripts.js' %}"></script>
</body>
{% endblock %}


